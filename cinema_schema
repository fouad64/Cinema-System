CREATE TABLE users (
    user_id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    email TEXT UNIQUE NOT NULL,
    password TEXT NOT NULL,
    role TEXT CHECK(role IN ('CUSTOMER','EMPLOYEE','ADMIN')) NOT NULL
);

-- Movies
CREATE TABLE movies (
    movie_id INTEGER PRIMARY KEY AUTOINCREMENT,
    title TEXT NOT NULL,
    genre TEXT CHECK(genre IN ('ACTION','DRAMA','COMEDY','HORROR','ROMANCE','THRILLER','ANIMATION','SCIFI')),
    rating TEXT CHECK(rating IN ('G','PG','PG13','R','NC17')),
    description TEXT
);

-- Showtimes
CREATE TABLE showtimes (
    showtime_id INTEGER PRIMARY KEY AUTOINCREMENT,
    movie_id INTEGER NOT NULL,
    show_datetime TEXT NOT NULL,
    screen_number INTEGER DEFAULT 1,
    available_seats INTEGER DEFAULT 50,
    ticket_price REAL DEFAULT 10.0,
    FOREIGN KEY (movie_id) REFERENCES movies(movie_id)
);

-- Reservations
CREATE TABLE reservations (
    reservation_id INTEGER PRIMARY KEY AUTOINCREMENT,
    customer_id INTEGER NOT NULL,
    showtime_id INTEGER NOT NULL,
    num_tickets INTEGER NOT NULL,
    seat_numbers TEXT,
    total_price REAL,
    status TEXT CHECK(status IN ('active','cancelled')) DEFAULT 'active',
    created_at TEXT DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (customer_id) REFERENCES users(user_id),
    FOREIGN KEY (showtime_id) REFERENCES showtimes(showtime_id)
);